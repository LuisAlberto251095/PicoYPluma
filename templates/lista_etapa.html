<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de {{ etapa|capitalize }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stily.css') }}">

    <style>
        body { background-color: #f4f6f9; font-family: 'Poppins', sans-serif; padding: 20px; }

        .container-xl {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }

        .header-flex {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }

        h1 { color: #2c3e50; margin: 0; }

        /* Botón Agregar */
        .btn-new {
            background-color: #27ae60;
            color: white;
            text-decoration: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.3s;
        }
        .btn-new:hover { background-color: #219150; transform: translateY(-2px); }

        /* Tabla Profesional */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; color: #555; font-weight: 600; text-transform: uppercase; font-size: 0.85rem; }
        tr:hover { background-color: #fcfcfc; }

        .tag-lote { background: #e0f7fa; color: #006064; padding: 5px 10px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; }
        .price { color: #27ae60; font-weight: bold; }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #777;
        }
        .empty-state i { font-size: 3rem; color: #ccc; margin-bottom: 15px; }

        .back-link {
            display: inline-block;
            margin-top: 20px;
            text-decoration: none;
            color: #555;
            font-weight: 600;
        }
    </style>
</head>
<body>

    <div class="container-xl">

        <div class="header-flex">
            <div>
                <h1>Gestión de <span style="color: #3498db;">{{ etapa|capitalize }}</span></h1>
                <p style="color: #777; margin-top: 5px;">Visualice o registre nuevos ingresos en esta etapa.</p>
            </div>

            <a href="{{ url_for('formulario_final_ave', etapa=etapa) }}" class="btn-new">
                <i class="fas fa-plus-circle"></i> Nuevo Registro
            </a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div style="padding: 10px; border-radius: 5px; margin-bottom: 15px;
                        background: {{ '#d4edda' if category == 'success' else '#f8d7da' }};
                        color: {{ '#155724' if category == 'success' else '#721c24' }};">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% if aves %}
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>Fecha Reg.</th>
                        <th>ID Lote</th>
                        <th>Especie / Raza</th>
                        <th>Cantidad</th>
                        <th>Costo Unit.</th>
                        <th>Inversión</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ave in aves %}
                    <tr>
                        <td>{{ ave.fecha_registro.strftime('%d/%m/%Y') }}</td>
                        <td><span class="tag-lote">{{ ave.lote_codigo }}</span></td>
                        <td>
                            <strong>{{ ave.especie }}</strong><br>
                            <small style="color:#777;">{{ ave.raza_color }}</small>
                        </td>
                        <td style="font-weight: bold; font-size: 1.1rem;">{{ ave.cantidad }}</td>
                        <td>${{ "%.2f"|format(ave.costo_unitario) }}</td>
                        <td class="price">${{ "%.2f"|format(ave.monto_pago) }}</td>
                        <td>
                            {% if session.get('role') == 'Propietario' %}
                            <a href="{{ url_for('eliminar_ave', id=ave.id) }}" onclick="return confirm('¿Seguro que desea eliminar este lote?')" style="color: #e74c3c; text-decoration: none;">
                                <i class="fas fa-trash"></i> Eliminar
                            </a>
                            {% else %}
                            <span style="color:#ccc;"><i class="fas fa-lock"></i></span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
            <div class="empty-state">
                <i class="fas fa-feather-alt"></i>
                <h3>No hay registros en {{ etapa }} aún.</h3>
                <p>Haga clic en el botón verde para registrar el primero.</p>
            </div>
        {% endif %}

        <div>
            <a href="{{ url_for('formulario_compra', categoria='aves') }}" class="back-link">
                <i class="fas fa-arrow-left"></i> Volver a Selección de Etapas
            </a>
        </div>

    </div>

</body>
</html>